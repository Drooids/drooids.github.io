function roadBuilder(e={containerId:"container",initCamera:"topdown",visible:{cars:!0,grid:!0}}){const t=this;var i=document.getElementById(e.containerId);this.initCamera=e.initCamera||"topdown";var o=new THREE.Scene,n=new THREE.PerspectiveCamera(65,i.clientWidth/i.clientHeight,.01,200);n.position.set(0,22,0);i.clientWidth,i.clientHeight;var a=new THREE.PerspectiveCamera(65,i.clientWidth/i.clientHeight,.01,200),s=n,r=new THREE.WebGLRenderer({antialias:!0});r.setSize(i.clientWidth,i.clientHeight),r.setClearColor(4552378,.4),r.setSize(i.offsetWidth,i.offsetHeight),i.appendChild(r.domElement);var l=new THREE.CSS2DRenderer;l.setSize(i.clientWidth,i.clientHeight),l.domElement.style.position="absolute",l.domElement.style.top=i.getBoundingClientRect().top+"px",l.domElement.style.left=i.getBoundingClientRect().left+"px",document.body.appendChild(l.domElement);var d=new THREE.OrbitControls(n,r.domElement);d.enableZoom=!0,d.enableRotate=!1,d.enablePan=!1;var E=new THREE.Clock,c=new THREE.AmbientLight(16777215);o.add(c),directionalLight=new THREE.DirectionalLight(16777215,100),directionalLight.position.set(0,200,0),directionalLight.castShadow=!0,o.add(directionalLight),light4=new THREE.PointLight(16777215,80),o.add(light4);var p=new THREE.GridHelper(30,30,7090847,7090847);p.visible=e.visible.grid,o.add(p);new THREE.OBJLoader;var h=[0,0,10,10,0,10,14,0,2,10,0,-4,2,0,8,-7,0,-5,-8,0,-9,-14,0,-7,-13,0,-2,-14,0,3,-11,0,10,0,0,10],m=600,H=[-.6,-.5,0,.02,.5,.52,1.02,1.04,1.54,1.64],w=new THREE.BufferGeometry;w.createRoad=THREEg.createRoad,w.createRoad(h,m,H),tex=(new THREE.TextureLoader).load("./animation/stride.png"),tex.wrapS=THREE.RepeatWrapping,tex.repeat.set(2*m);var R=[new THREE.MeshBasicMaterial({color:3693453,side:THREE.DoubleSide,wireframe:!1}),new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,wireframe:!1}),new THREE.MeshBasicMaterial({map:tex,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,wireframe:!1}),new THREE.MeshBasicMaterial({map:tex,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({map:tex,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,wireframe:!1}),new THREE.MeshBasicMaterial({color:3693453,side:THREE.DoubleSide,wireframe:!1})],T=new THREE.Mesh(w,R);o.add(T);var f=.08,u=new THREE.Mesh(new THREE.BoxBufferGeometry(.12,1.9*f,.4),new THREE.MeshBasicMaterial({color:255,side:THREE.DoubleSide,wireframe:!0}));o.add(u);var M,b,g,y=0,x=new THREE.BufferGeometry;x.positions=new Float32Array(6),x.addAttribute("position",new THREE.BufferAttribute(x.positions,3).setDynamic(!0)),lineTngt=new THREE.Line(x,new THREE.LineBasicMaterial({color:65535,side:THREE.DoubleSide})),o.add(lineTngt);var B=new THREE.BufferGeometry;B.positions=new Float32Array(6),B.addAttribute("position",new THREE.BufferAttribute(B.positions,3).setDynamic(!0)),lineNorm=new THREE.Line(B,new THREE.LineBasicMaterial({color:16711680,side:THREE.DoubleSide})),o.add(lineNorm);var v=new THREE.BufferGeometry;function S(e=0,t=0){this.id=e,this.distance=t,this.mesh=null,this.follower={},this.activeCamera=!1,this.increment=1,this.trackid=Math.floor(Math.random()*H.length)}function C(){this.cars=[]}v.positions=new Float32Array(6),v.addAttribute("position",new THREE.BufferAttribute(v.positions,3).setDynamic(!0)),lineBino=new THREE.Line(v,new THREE.LineBasicMaterial({color:255,side:THREE.DoubleSide})),o.add(lineBino),C.prototype.add=function(t=0,i=0){const n=new S(t,i);n.follower=new THREE.Mesh(new THREE.BoxBufferGeometry(.1,.2*f,.1),new THREE.MeshBasicMaterial({color:16711680,side:THREE.DoubleSide,wireframe:!0})),o.add(n.follower);const a=(new THREE.GLTFLoader).setPath("./animation/vehicle/");a.load("/scene.gltf",(function(i){let a=i.scene;a.scale.set(5e-4,5e-4,5e-4),a.cid=t,a.traverse((e=>{e.isMesh&&"Cube001_Material001_0"==e.name&&(e.material.color.r=Math.floor(32*Math.random()),e.material.color.g=Math.floor(32*Math.random()),e.material.color.b=Math.floor(32*Math.random()))}));const s=document.createElement("div");s.className="label",s.textContent=n.id,s.style.marginTop="-1em";const r=new THREE.CSS2DObject(s);r.position.set(0,0,0),a.add(r),n.mesh=a,n.mesh.visible=e.visible.cars,o.add(a)})),this.cars.push(n)},C.prototype.remove=function(e){for(var t=0;t<this.cars.length;t++)this.cars[t].id==e&&(o.remove(this.cars[t].mesh),o.remove(this.cars[t].follower),this.cars.splice(t,1))};var z,D=new C,L=8,A=0;function W(e){const t=e.domElement,i=t.clientWidth,o=t.clientHeight,n=t.width!==i||t.height!==o;return n&&e.setSize(i,o,!1),n}function G(){if(z=E.getElapsedTime(),requestAnimationFrame(G),W(r)){const e=r.domElement;n.aspect=e.clientWidth/e.clientHeight,n.updateProjectionMatrix()}if("chase"==t.initCamera&&(s=a),r.render(o,s),l.render(o,s),z-A>.04){D.cars.map((e=>{if(e.mesh){let t=e.distance%w.points.length,i=w.points[t].x+w.n[t].x*H[e.trackid]*.6,o=w.points[t].y+f,n=w.points[t].z+w.n[t].z*H[e.trackid]*.6;e.follower.position.set(i,o,n),e.follower.rotation.y=1.57+Math.atan2(-w.t[t].z,w.t[t].x),e.mesh.position.set(i,o,n),e.mesh.rotation.y=1.57+Math.atan2(-w.t[t].z,w.t[t].x),e.distance+=e.increment}})),M=w.points[y].x+w.n[y].x*H[1]*.6,b=w.points[y].y+f,g=w.points[y].z+w.n[y].z*H[1]*.6,u.position.set(M,b,g),u.rotation.y=1.57+Math.atan2(-w.t[y].z,w.t[y].x),y+=2,y>=w.points.length&&(y=0),x.positions[0]=w.points[L].x,x.positions[1]=w.points[L].y,x.positions[2]=w.points[L].z,x.positions[3]=w.points[L].x+w.t[L].x,x.positions[4]=w.points[L].y+w.t[L].y,x.positions[5]=w.points[L].z+w.t[L].z,x.attributes.position.needsUpdate=!0,B.positions[0]=w.points[L].x,B.positions[1]=w.points[L].y,B.positions[2]=w.points[L].z,B.positions[3]=w.points[L].x+w.n[L].x,B.positions[4]=w.points[L].y+w.n[L].y,B.positions[5]=w.points[L].z+w.n[L].z,B.attributes.position.needsUpdate=!0,v.positions[0]=w.points[L].x,v.positions[1]=w.points[L].y,v.positions[2]=w.points[L].z,v.positions[3]=w.points[L].x+w.b[L].x,v.positions[4]=w.points[L].y+w.b[L].y,v.positions[5]=w.points[L].z+w.b[L].z,v.attributes.position.needsUpdate=!0,L++,L===w.points.length&&(L=0);const t=D.cars.find((e=>e.activeCamera));if(t&&t.mesh){var e=new THREE.Vector3(1,1,0);e.applyMatrix4(t.follower.matrixWorld);a.position.x=e.x,a.position.y=e.y,a.position.z=e.z,a.lookAt(t.follower.position)}A=z}d.update()}return G(),{scene:o,camera:n,chaseCamera:a,currentCamera:s,gridHelper:p,car:S,theCarsManager:D}}