function roadBuilder(e={containerId:"container",initCamera:"topdown",visible:{cars:!0,grid:!0}}){var i=document.getElementById(e.containerId),t=new THREE.Scene,o=new THREE.PerspectiveCamera(65,i.clientWidth/i.clientHeight,.01,200);o.position.set(0,22,0);i.clientWidth,i.clientHeight;var n=new THREE.PerspectiveCamera(65,i.clientWidth/i.clientHeight,.01,200),a=o;"chase"==e.initCamera&&(a=n);var s=new THREE.WebGLRenderer({antialias:!0});s.setSize(i.clientWidth,i.clientHeight),s.setClearColor(4552378,.4),s.setSize(i.offsetWidth,i.offsetHeight),i.appendChild(s.domElement);var r=new THREE.CSS2DRenderer;r.setSize(i.clientWidth,i.clientHeight),r.domElement.style.position="absolute",r.domElement.style.top=i.getBoundingClientRect().top+"px",document.body.appendChild(r.domElement);var l=new THREE.OrbitControls(o,s.domElement);l.enableZoom=!0,l.enableRotate=!1,l.enablePan=!1;var d=new THREE.Clock,E=new THREE.AmbientLight(16777215);t.add(E),directionalLight=new THREE.DirectionalLight(16777215,100),directionalLight.position.set(0,200,0),directionalLight.castShadow=!0,t.add(directionalLight),light4=new THREE.PointLight(16777215,80),t.add(light4);var c=new THREE.GridHelper(30,30,7090847,7090847);c.visible=e.visible.grid,t.add(c);new THREE.OBJLoader;var p=[0,0,10,10,0,10,14,0,2,10,0,-4,2,0,8,-7,0,-5,-8,0,-9,-14,0,-7,-13,0,-2,-14,0,3,-11,0,10,0,0,10],h=600,m=[-.6,-.5,0,.02,.5,.52,1.02,1.04,1.54,1.64],H=new THREE.BufferGeometry;H.createRoad=THREEg.createRoad,H.createRoad(p,h,m),tex=(new THREE.TextureLoader).load("./animation/stride.png"),tex.wrapS=THREE.RepeatWrapping,tex.repeat.set(2*h);var w=[new THREE.MeshBasicMaterial({color:3693453,side:THREE.DoubleSide,wireframe:!1}),new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,wireframe:!1}),new THREE.MeshBasicMaterial({map:tex,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,wireframe:!1}),new THREE.MeshBasicMaterial({map:tex,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({map:tex,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,wireframe:!1}),new THREE.MeshBasicMaterial({color:3693453,side:THREE.DoubleSide,wireframe:!1})],R=new THREE.Mesh(H,w);t.add(R);var T=.08,f=new THREE.Mesh(new THREE.BoxBufferGeometry(.12,1.9*T,.4),new THREE.MeshBasicMaterial({color:255,side:THREE.DoubleSide,wireframe:!0}));t.add(f);var u,M,b,g=0,y=new THREE.BufferGeometry;y.positions=new Float32Array(6),y.addAttribute("position",new THREE.BufferAttribute(y.positions,3).setDynamic(!0)),lineTngt=new THREE.Line(y,new THREE.LineBasicMaterial({color:65535,side:THREE.DoubleSide})),t.add(lineTngt);var v=new THREE.BufferGeometry;v.positions=new Float32Array(6),v.addAttribute("position",new THREE.BufferAttribute(v.positions,3).setDynamic(!0)),lineNorm=new THREE.Line(v,new THREE.LineBasicMaterial({color:16711680,side:THREE.DoubleSide})),t.add(lineNorm);var x=new THREE.BufferGeometry;function B(e=0,i=0){this.id=e,this.distance=i,this.mesh=null,this.follower={},this.activeCamera=!1,this.increment=1,this.trackid=Math.floor(Math.random()*m.length)}function S(){this.cars=[]}x.positions=new Float32Array(6),x.addAttribute("position",new THREE.BufferAttribute(x.positions,3).setDynamic(!0)),lineBino=new THREE.Line(x,new THREE.LineBasicMaterial({color:255,side:THREE.DoubleSide})),t.add(lineBino),S.prototype.add=function(i=0,o=0){const n=new B(i,o);n.follower=new THREE.Mesh(new THREE.BoxBufferGeometry(.1,.2*T,.1),new THREE.MeshBasicMaterial({color:16711680,side:THREE.DoubleSide,wireframe:!0})),t.add(n.follower);const a=(new THREE.GLTFLoader).setPath("./animation/vehicle/");a.load("/scene.gltf",(function(o){let a=o.scene;a.scale.set(5e-4,5e-4,5e-4),a.cid=i,a.traverse((e=>{e.isMesh&&"Cube001_Material001_0"==e.name&&(e.material.color.r=Math.floor(32*Math.random()),e.material.color.g=Math.floor(32*Math.random()),e.material.color.b=Math.floor(32*Math.random()))}));const s=document.createElement("div");s.className="label",s.textContent=n.id,s.style.marginTop="-1em";const r=new THREE.CSS2DObject(s);r.position.set(0,0,0),a.add(r),n.mesh=a,n.mesh.visible=e.visible.cars,t.add(a)})),this.cars.push(n)},S.prototype.remove=function(e){for(var i=0;i<this.cars.length;i++)this.cars[i].id==e&&(t.remove(this.cars[i].mesh),t.remove(this.cars[i].follower),this.cars.splice(i,1))};var z=new S;z.add(0,300),z.cars[0].activeCamera=!0,z.add(1,200);var C,D=8,L=0;function A(e){const i=e.domElement,t=i.clientWidth,o=i.clientHeight,n=i.width!==t||i.height!==o;return n&&e.setSize(t,o,!1),n}function W(){if(C=d.getElapsedTime(),requestAnimationFrame(W),A(s)){const e=s.domElement;o.aspect=e.clientWidth/e.clientHeight,o.updateProjectionMatrix()}if(s.render(t,a),r.render(t,a),C-L>.04){z.cars.map((e=>{if(e.mesh){let i=e.distance%H.points.length,t=H.points[i].x+H.n[i].x*m[e.trackid]*.6,o=H.points[i].y+T,n=H.points[i].z+H.n[i].z*m[e.trackid]*.6;e.follower.position.set(t,o,n),e.follower.rotation.y=1.57+Math.atan2(-H.t[i].z,H.t[i].x),e.mesh.position.set(t,o,n),e.mesh.rotation.y=1.57+Math.atan2(-H.t[i].z,H.t[i].x),e.distance+=e.increment}})),u=H.points[g].x+H.n[g].x*m[1]*.6,M=H.points[g].y+T,b=H.points[g].z+H.n[g].z*m[1]*.6,f.position.set(u,M,b),f.rotation.y=1.57+Math.atan2(-H.t[g].z,H.t[g].x),g+=2,g>=H.points.length&&(g=0),y.positions[0]=H.points[D].x,y.positions[1]=H.points[D].y,y.positions[2]=H.points[D].z,y.positions[3]=H.points[D].x+H.t[D].x,y.positions[4]=H.points[D].y+H.t[D].y,y.positions[5]=H.points[D].z+H.t[D].z,y.attributes.position.needsUpdate=!0,v.positions[0]=H.points[D].x,v.positions[1]=H.points[D].y,v.positions[2]=H.points[D].z,v.positions[3]=H.points[D].x+H.n[D].x,v.positions[4]=H.points[D].y+H.n[D].y,v.positions[5]=H.points[D].z+H.n[D].z,v.attributes.position.needsUpdate=!0,x.positions[0]=H.points[D].x,x.positions[1]=H.points[D].y,x.positions[2]=H.points[D].z,x.positions[3]=H.points[D].x+H.b[D].x,x.positions[4]=H.points[D].y+H.b[D].y,x.positions[5]=H.points[D].z+H.b[D].z,x.attributes.position.needsUpdate=!0,D++,D===H.points.length&&(D=0);const i=z.cars.find((e=>e.activeCamera));if(i&&i.mesh){var e=new THREE.Vector3(1,1,0);e.applyMatrix4(i.follower.matrixWorld);n.position.x=e.x,n.position.y=e.y,n.position.z=e.z,n.lookAt(i.follower.position)}L=C}l.update()}return W(),{scene:t,camera:o,chaseCamera:n,currentCamera:a,gridHelper:c,car:B,theCarsManager:z}}