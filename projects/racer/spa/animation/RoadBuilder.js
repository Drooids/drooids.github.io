function roadBuilder(e={containerId:"container",initCamera:"topdown",visible:{cars:!0,grid:!0}}){const t=this;var i=document.getElementById(e.containerId);this.initCamera=e.initCamera||"topdown";var o=new THREE.Scene;let n,a,s=400;i.clientWidth<=768?(n=50,a=1200):i.clientWidth>=769&&i.clientWidth<=1080?(n=50,a=1475):(n=40,a=1800),console.log(n,s,a,i.clientWidth/i.clientHeight);var r=new THREE.PerspectiveCamera(n,i.clientWidth/i.clientHeight,35,38);r.position.set(0,36,0);var l=new THREE.PerspectiveCamera(n,i.clientWidth/i.clientHeight,3,6),d=r;let c=window.devicePixelRatio,E=!0;c>1&&(E=!1);var p=new THREE.WebGLRenderer({antialias:E,powerPreference:"high-performance"});p.setSize(i.clientWidth,i.clientHeight),p.setClearColor(4552378,.4),i.appendChild(p.domElement);var h=new THREE.CSS2DRenderer;h.setSize(i.clientWidth,i.clientHeight),h.domElement.style.position="absolute",h.domElement.style.top=i.getBoundingClientRect().top+"px",h.domElement.style.left=i.getBoundingClientRect().left+"px",h.domElement.id="label-renderer-"+e.containerId,document.body.appendChild(h.domElement);var m=new THREE.OrbitControls(r,p.domElement);m.enableZoom=!0,m.enableRotate=!1,m.enablePan=!1;var w=new THREE.Clock,R=new THREE.AmbientLight(16777215);o.add(R),directionalLight=new THREE.DirectionalLight(16777215,100),directionalLight.position.set(0,200,0),directionalLight.castShadow=!0,o.add(directionalLight),light4=new THREE.PointLight(16777215,80),o.add(light4);var H=new THREE.GridHelper(30,30,7090847,7090847);H.visible=e.visible.grid,o.add(H);new THREE.OBJLoader;var T=[0,0,10,10,0,10,14,0,2,10,0,-4,2,0,8,-7,0,-5,-8,0,-9,-14,0,-7,-13,0,-2,-14,0,3,-11,0,10,0,0,10],f=600,u=[-.6,-.5,0,.02,.5,.52,1.02,1.04,1.54,1.64],b=new THREE.BufferGeometry;b.createRoad=THREEg.createRoad,b.createRoad(T,f,u),tex=(new THREE.TextureLoader).load("./animation/stride.png"),tex.wrapS=THREE.RepeatWrapping,tex.repeat.set(2*f);var g=[new THREE.MeshBasicMaterial({color:3693453,side:THREE.DoubleSide,wireframe:!1}),new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,wireframe:!1}),new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,wireframe:!1}),new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide}),new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,wireframe:!1}),new THREE.MeshBasicMaterial({color:3693453,side:THREE.DoubleSide,wireframe:!1})],M=new THREE.Mesh(b,g);o.add(M);var v=.08,y=new THREE.BufferGeometry;y.positions=new Float32Array(6),y.addAttribute("position",new THREE.BufferAttribute(y.positions,3).setDynamic(!0)),lineTngt=new THREE.Line(y,new THREE.LineBasicMaterial({color:65535,side:THREE.DoubleSide})),o.add(lineTngt);var x=new THREE.BufferGeometry;x.positions=new Float32Array(6),x.addAttribute("position",new THREE.BufferAttribute(x.positions,3).setDynamic(!0)),lineNorm=new THREE.Line(x,new THREE.LineBasicMaterial({color:16711680,side:THREE.DoubleSide})),o.add(lineNorm);var B=new THREE.BufferGeometry;function C(e=0,t=0){this.id=e,this.distance=t,this.mesh=null,this.follower={},this.activeCamera=!1,this.increment=1,this.trackid=Math.floor(Math.random()*u.length)}function S(){this.cars=[]}B.positions=new Float32Array(6),B.addAttribute("position",new THREE.BufferAttribute(B.positions,3).setDynamic(!0)),lineBino=new THREE.Line(B,new THREE.LineBasicMaterial({color:255,side:THREE.DoubleSide})),o.add(lineBino),S.prototype.add=function(t=0,i=0){const n=new C(t,i);n.follower=new THREE.Mesh(new THREE.BoxBufferGeometry(.1,.2*v,.1),new THREE.MeshBasicMaterial({color:16711680,side:THREE.DoubleSide,wireframe:!0})),o.add(n.follower);const a=(new THREE.GLTFLoader).setPath("./animation/vehicle/");a.load("/scene.gltf",(function(i){let a=i.scene;a.scale.set(5e-4,5e-4,5e-4),a.cid=t,a.traverse((e=>{e.isMesh&&"Cube001_Material001_0"==e.name&&(e.material.color.r=Math.floor(32*Math.random()),e.material.color.g=Math.floor(32*Math.random()),e.material.color.b=Math.floor(32*Math.random()))}));const s=document.createElement("div");s.className="label",s.textContent=n.id;const r=new THREE.CSS2DObject(s);r.position.set(0,0,0),a.add(r),n.mesh=a,n.mesh.visible=e.visible.cars,o.add(a)})),this.cars.push(n)},S.prototype.remove=function(e){for(var t=0;t<this.cars.length;t++)this.cars[t].id==e&&(o.remove(this.cars[t].mesh),o.remove(this.cars[t].follower),this.cars.splice(t,1))};var z,L=new S,D=8,W=0;function A(e){const t=e.domElement,i=t.clientWidth,o=t.clientHeight,n=t.width!==i||t.height!==o;return n&&e.setSize(i,o,!1),n}function G(){if(z=w.getElapsedTime(),requestAnimationFrame(G),A(p)){const e=p.domElement;r.aspect=e.clientWidth/e.clientHeight,r.updateProjectionMatrix()}if("chase"==t.initCamera&&(d=l),p.render(o,d),h.render(o,d),z-W>.02){L.cars.map((e=>{if(e.mesh){let t=e.distance%b.points.length,i=b.points[t].x+b.n[t].x*u[e.trackid]*.6,o=b.points[t].y+v,n=b.points[t].z+b.n[t].z*u[e.trackid]*.6;e.follower.position.set(i,o,n),e.follower.rotation.y=1.57+Math.atan2(-b.t[t].z,b.t[t].x),e.mesh.position.set(i,o,n),e.mesh.rotation.y=1.57+Math.atan2(-b.t[t].z,b.t[t].x),e.distance+=e.increment}})),y.positions[0]=b.points[D].x,y.positions[1]=b.points[D].y,y.positions[2]=b.points[D].z,y.positions[3]=b.points[D].x+b.t[D].x,y.positions[4]=b.points[D].y+b.t[D].y,y.positions[5]=b.points[D].z+b.t[D].z,y.attributes.position.needsUpdate=!0,x.positions[0]=b.points[D].x,x.positions[1]=b.points[D].y,x.positions[2]=b.points[D].z,x.positions[3]=b.points[D].x+b.n[D].x,x.positions[4]=b.points[D].y+b.n[D].y,x.positions[5]=b.points[D].z+b.n[D].z,x.attributes.position.needsUpdate=!0,B.positions[0]=b.points[D].x,B.positions[1]=b.points[D].y,B.positions[2]=b.points[D].z,B.positions[3]=b.points[D].x+b.b[D].x,B.positions[4]=b.points[D].y+b.b[D].y,B.positions[5]=b.points[D].z+b.b[D].z,B.attributes.position.needsUpdate=!0,D++,D===b.points.length&&(D=0);const t=L.cars.find((e=>e.activeCamera));if(t&&t.mesh){var e=new THREE.Vector3(3,3,0);e.applyMatrix4(t.follower.matrixWorld);l.position.x=e.x,l.position.y=e.y,l.position.z=e.z,l.lookAt(t.follower.position)}W=z}m.update()}return G(),{scene:o,camera:r,chaseCamera:l,currentCamera:d,gridHelper:H,car:C,theCarsManager:L}}