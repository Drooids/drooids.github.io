(function(e,t){"object"===typeof exports&&"undefined"!==typeof module?t(exports):"function"===typeof define&&define.amd?define(["exports"],t):t(e.THREEg=e.THREEg||{})})(this,(function(e){"use strict";var t;function s(e){void 0===e&&(e={}),t=this,t.lidAngleDefault=void 0===e.lidAngle0&&void 0===e.lidAngle1&&void 0===e.lidAngle2&&void 0===e.lidAngle3&&void 0===e.lidAngle4&&void 0===e.lidAngle5,t.explodeDefault=void 0===e.explode,t.widthSegments=void 0!==e.widthSegments?e.widthSegments:2,t.heightSegments=void 0!==e.heightSegments?e.heightSegments:2,t.depthSegments=void 0!==e.depthSegments?e.depthSegments:2,t.smoothness=void 0!==e.smoothness?e.smoothness:4,t.uvmode=void 0!==e.uvmode?e.uvmode:0,t.contourmode=void 0!==e.contourmode?e.contourmode:"rounding",t.explodemode=void 0!==e.explodemode?e.explodemode:"center",t.sides=void 0!==e.sides?e.sides:[1,1,1,1,1,1],t.lidHinges=void 0!==e.lidHinges?e.lidHinges:[0,0,0,0,0,0],t.materials=void 0!==e.materials?e.materials:[0,1,2,3,4,5,6,7,8,9,10],t.width=void 0!==e.width?e.width:function(e){return 1},t.height=void 0!==e.height?e.height:function(e){return 1},t.depth=void 0!==e.depth?e.depth:function(e){return 1},t.radius=void 0!==e.radius?e.radius:function(e){return.1},t.waffleDeep=void 0!==e.waffleDeep?e.waffleDeep:function(e){return 0},t.rounding=void 0!==e.rounding?e.rounding:function(e){return 1},t.profile=void 0!==e.profile?e.profile:function(e,t){return Math.sin(e)},t.pointX=void 0!==e.pointX?e.pointX:function(e){return.001},t.pointY=void 0!==e.pointY?e.pointY:function(e){return.999},t.lidAngle0=void 0!==e.lidAngle0?e.lidAngle0:function(e){return 0},t.lidAngle1=void 0!==e.lidAngle1?e.lidAngle1:function(e){return 0},t.lidAngle2=void 0!==e.lidAngle2?e.lidAngle2:function(e){return 0},t.lidAngle3=void 0!==e.lidAngle3?e.lidAngle3:function(e){return 0},t.lidAngle4=void 0!==e.lidAngle4?e.lidAngle4:function(e){return 0},t.lidAngle5=void 0!==e.lidAngle5?e.lidAngle5:function(e){return 0},t.explode=void 0!==e.explode?e.explode:function(e){return 0},t.widthP=function(e){return t.width(e)-2*t.radius(e)},t.heightP=function(e){return t.height(e)-2*t.radius(e)},t.depthP=function(e){return t.depth(e)-2*t.radius(e)},t.lidAngles=[t.lidAngle0,t.lidAngle1,t.lidAngle2,t.lidAngle3,t.lidAngle4,t.lidAngle5],t.buildMagicBox=o,t.morphVerticesMagicBox=i,t.buildMagicBox(),t.morphVerticesMagicBox()}function o(){var e,s,o;t=this;var i,n,r,a,u,d,c,f,l,p=t.widthSegments,h=t.heightSegments,v=t.depthSegments,g=t.smoothness;t.vertexFaces=[],t.vertexPositions=[],t.vPlanesIdx=[0,0,0,0,0,0],t.vEdgesIdx=[0,0,0,0,0,0,0,0,0,0,0,0],t.vCornersIdx=[0,0,0,0,0,0,0,0],t.fPlanesIdx=[-1,-1,-1,-1,-1,-1],t.fEdgesIdx=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],t.fCornersIdx=[-1,-1,-1,-1,-1,-1,-1,-1],t.fPlanesCount=[],t.fEdgesCount=[],t.fCornersCount=[];for(var x=[[4,7,8,9],[5,6,10,11],[2,3,9,10],[0,1,8,11],[0,3,6,7],[1,2,4,5]],m=[[0,3,4,7],[1,2,5,6],[0,1,2,3],[4,5,6,7],[2,3,6,7],[0,1,4,5]],y=0;y<6;y++)o=t.sides[y],0!==o&&2!==o&&5!==o&&6!==o&&9!==o||(t.vPlanesIdx[y]=-1),0!==o&&3!==o&&5!==o&&7!==o&&9!==o||(t.vEdgesIdx[x[y][0]]=-1,t.vEdgesIdx[x[y][1]]=-1,t.vEdgesIdx[x[y][2]]=-1,t.vEdgesIdx[x[y][3]]=-1),0!==o&&4!==o&&6!==o&&7!==o&&9!==o||(t.vCornersIdx[m[y][0]]=-1,t.vCornersIdx[m[y][1]]=-1,t.vCornersIdx[m[y][2]]=-1,t.vCornersIdx[m[y][3]]=-1);t.vertexCount=0,t.faceCount=0;for(y=0;y<6;y++)0===t.vPlanesIdx[y]&&(t.vPlanesIdx[y]=t.vertexCount,t.fPlanesIdx[y]=t.faceCount,e=y<2?h:p,s=y<4?v:h,t.vertexCount+=(2*e+1)*s+e+1,t.faceCount+=e*s*4,t.fPlanesCount[y]=t.faceCount-t.fPlanesIdx[y]);for(y=0;y<12;y++)e=g,0===t.vEdgesIdx[y]&&(t.vEdgesIdx[y]=t.vertexCount,t.fEdgesIdx[y]=t.faceCount,s=y<4?p:y<8?h:v,t.vertexCount+=(2*e+1)*s+e+1,t.faceCount+=e*s*4,t.fEdgesCount[y]=t.faceCount-t.fEdgesIdx[y]);for(y=0;y<8;y++)0===t.vCornersIdx[y]&&(t.vCornersIdx[y]=t.vertexCount,t.fCornersIdx[y]=t.faceCount,t.vertexCount+=(g+1)*(g+2)/2,t.faceCount+=g*g,t.fCornersCount[y]=t.faceCount-t.fCornersIdx[y]);function M(e,s){var o,u,x,m,y,M;"plane"===e&&(1===s||3===s||4===s?(y=3,M=6):(y=6,M=3),o=s<2?h:p,u=s<4?v:h,x=t.vPlanesIdx[s],m=t.fPlanesIdx[s]),"edge"===e&&(0===s||2===s||5===s||7===s||8===s||10===s?(y=3,M=6):(y=6,M=3),o=s<4?p:s<8?h:v,u=g,x=t.vEdgesIdx[s],m=t.fEdgesIdx[s]);for(var b=[],w=[],P=0;P<o+1;P++){for(var C=0;C<u+1;C++)i=4*((P-1)*u+C)+m,n=9*i,r=4*(P*u+C)+m,a=9*r,b=[],w=[],P>0&&(C<u&&(b.push(n),w.push(n+M),b.push(n+18),w.push(n+18+y)),C>0&&(b.push(n-9),w.push(n-9+y),b.push(n-18),w.push(n-18+M))),P<o&&(C<u&&(b.push(a+9),w.push(a+9+M),b.push(a),w.push(a+y)),C>0&&(b.push(a-9),w.push(a-9+M),b.push(a-27),w.push(a-27+y))),t.vertexFaces.push(b),t.vertexPositions.push(w);if(P<o)for(C=0;C<u;C++)b=[],w=[],d=9*(4*(P*u+C)+m),b.push(d),w.push(d),b.push(d+9),w.push(d+9),b.push(d+18),w.push(d+18),b.push(d+27),w.push(d+27),t.vertexFaces.push(b),t.vertexPositions.push(w)}for(P=0;P<o+1;P++)for(C=0;C<u+1;C++){c=(2*u+1)*P+C+x;for(var E=0;E<t.vertexPositions[c].length;E++)l=t.vertexPositions[c][E]/3*2,t.uvs[l]=0===s||2===s||5===s||7===s||8===s||10===s?"plane"===e?(o-P)/o:P/o:"plane"===e?P/o:(o-P)/o,t.uvs[l+1]=C/u}for(P=0;P<o;P++)for(C=0;C<u;C++){f=(2*u+1)*P+C+u+1+x;for(E=0;E<t.vertexPositions[f].length;E++)l=t.vertexPositions[f][E]/3*2,t.uvs[l]=0===s||2===s||5===s||7===s||8===s||10===s?"plane"===e?(o-P-.5)/o:(P+.5)/o:"plane"===e?(P+.5)/o:(o-P-.5)/o,t.uvs[l+1]=(C+.5)/u}}function b(e){var s,o,i,n,r,a=[],f=[],p=e<4?1:-1,h=0,v=e<4?3:6,x=e<4?6:3;const m=Math.PI/2;function y(e){d=9*u,a.push(d),f.push(d+e)}function M(){for(var e=0;e<t.vertexPositions[c].length;e++)l=t.vertexPositions[c][e]/3*2,t.uvs[l]=i,t.uvs[l+1]=n}function b(){var s,o=1/g;if(c=t.vCornersIdx[e],0===t.uvmode){i=.5,n=1,M(),c++;for(var a=1;a<=g;a++){i=.5-p*a*o/2,n-=o;for(var u=0;u<=a;u++)M(),c++,i+=p*o}}if(1===t.uvmode){i=.5,n=.5,M(),c++;for(a=1;a<=g;a++){s=a/g,r=m*(e%4);for(u=0;u<=a;u++)i=.5*(1-p*s*Math.sin(r)),n=.5*(1+s*Math.cos(r)),M(),c++,r+=m/a}}}a=[9*t.fCornersIdx[e]],f=[9*t.fCornersIdx[e]],t.vertexFaces.push(a),t.vertexPositions.push(f);for(var w=1;w<=g;w++){s=(w-1)*(w-1)+t.fCornersIdx[e],o=w*w+t.fCornersIdx[e];for(var P=0;P<=w;P++)a=[],f=[],0===P&&(u=s,y(v),w<g&&(u=o,y(h),u++,y(x))),P>0&&P<w&&(u=s+2*(P-1),y(x),u++,y(h),u++,y(v),w<g&&(u=o+2*P-1,y(v),u++,y(h),u++,y(x))),P===w&&(u=o-1,y(x),w<g&&(u=(w+1)*(w+1)-2+t.fCornersIdx[e],y(v),u++,y(h))),t.vertexFaces.push(a),t.vertexPositions.push(f)}b()}t.positions=new Float32Array(9*t.faceCount),t.normals=new Float32Array(9*t.faceCount),t.uvs=new Float32Array(6*t.faceCount),t.addAttribute("position",new THREE.BufferAttribute(t.positions,3).setDynamic(!0)),t.addAttribute("normal",new THREE.BufferAttribute(t.normals,3).setDynamic(!0)),t.addAttribute("uv",new THREE.BufferAttribute(t.uvs,2));for(y=0;y<6;y++)t.vPlanesIdx[y]>-1&&(M("plane",y),t.addGroup(3*t.fPlanesIdx[y],3*t.fPlanesCount[y],t.materials[y]));for(y=0;y<12;y++)t.vEdgesIdx[y]>-1&&(M("edge",y),t.addGroup(3*t.fEdgesIdx[y],3*t.fEdgesCount[y],t.materials[Math.floor(y/4)+6]));for(y=0;y<8;y++)t.vCornersIdx[y]>-1&&(b(y),t.addGroup(3*t.fCornersIdx[y],3*t.fCornersCount[y],t.materials[Math.floor(y/4)+9]))}function i(e){var s=void 0!==e?e:0;t=this;var o,i,n,r,a,u=t.widthSegments,d=t.heightSegments,c=t.depthSegments,f=t.smoothness;const l=Math.PI,p=Math.PI/2;function h(e){var o=t.pointX(s),i=t.pointY(s);function n(e){var t,s=p-2*o;if(0===s)t=e/(2*o);else{var n=o/s,r=n*n+e/s;t=-n+(o<p/2?1:-1)*Math.sqrt(r)}return(1-2*i)*t*t+2*i*t}function r(e){var t=(1-i)/(p-o);return e>o?t*e+1-p*t:i/o*e}if("rounding"===t.contourmode){var a=2/l*Math.asin(Math.sin(e)),u=Math.sin(e);return a+t.rounding(s)*(u-a)}var d="profile"===t.contourmode?t.profile:"bezier"===t.contourmode?n:r;return e<0?-d(-e,s):e>=0&&e<=p?d(e,s):e>p&&e<=l?d(l-e,s):e>l&&e<=3*p?-d(e-l,s):e>3*p&&e<=2*l?-d(2*l-e,s):e>2*l&&e<=5*p+.001?d(e-2*l,s):void 0}function v(e){return h(e+p)}function g(e,o){var i,n,r,a,l,g,x,m,y,M,b,w,P,C,E,A,z,I={},D={},R={},q={};"plane"===e&&(i=o<2?d:u,n=o<4?c:d,r=t.vPlanesIdx[o],a=t.fPlanesIdx[o]),"edge"===e&&(i=o<4?u:o<8?d:c,n=f,r=t.vEdgesIdx[o],a=t.fEdgesIdx[o]);function L(o){for(var u=0;u<i+1;u++){y=u/i;for(var d=0;d<n+1;d++){M=d/n,"plane"===e&&(t.lidAngleDefault?(o<2&&(w=1-2*o,g=w*t.width(s)/2,x=(M-.5)*t.heightP(s),m=(y-.5)*t.depthP(s)),2!==o&&3!==o||(w=5-2*o,g=(y-.5)*t.widthP(s),x=w*t.height(s)/2,m=(M-.5)*t.depthP(s)),o>3&&(w=9-2*o,g=(y-.5)*t.widthP(s),x=(M-.5)*t.heightP(s),m=w*t.depth(s)/2)):(o<2&&(w=1-2*o,g=w*t.width(s)/2,0===t.lidHinges[o]?(g+=w*Math.sin(t.lidAngles[o](s))*M*t.depthP(s),x=(Math.cos(t.lidAngles[o](s))*M-.5)*t.heightP(s),m=(y-.5)*t.depthP(s)):(g+=w*Math.sin(t.lidAngles[o](s))*y*t.heightP(s),x=(M-.5)*t.heightP(s),m=(Math.cos(t.lidAngles[o](s))*y-.5)*t.depthP(s))),2!==o&&3!==o||(w=5-2*o,x=w*t.height(s)/2,0===t.lidHinges[o]?(g=(y-.5)*t.widthP(s),x+=w*Math.sin(t.lidAngles[o](s))*M*t.depthP(s),m=(Math.cos(t.lidAngles[o](s))*M-.5)*t.depthP(s)):(g=(Math.cos(t.lidAngles[o](s))*y-.5)*t.widthP(s),x+=w*Math.sin(t.lidAngles[o](s))*y*t.widthP(s),m=(M-.5)*t.depthP(s))),o>3&&(w=9-2*o,m=w*t.depth(s)/2,0===t.lidHinges[o]?(g=(Math.cos(t.lidAngles[o](s))*y-.5)*t.widthP(s),x=(M-.5)*t.heightP(s),m+=w*Math.sin(t.lidAngles[o](s))*y*t.widthP(s)):(g=(y-.5)*t.widthP(s),x=(Math.cos(t.lidAngles[o](s))*M-.5)*t.heightP(s),m+=w*Math.sin(t.lidAngles[o](s))*M*t.heightP(s))))),"edge"===e&&(b=p*(1-M),o<4&&(w=o<2?-1:1,P=1===o||2===o?-1:1,g=(y-.5)*t.widthP(s),x=w*t.radius(s)*h(b)+w*t.heightP(s)/2,m=P*t.radius(s)*v(b)+P*t.depthP(s)/2),o>3&&o<8&&(w=5===o||6===o?-1:1,P=o<6?-1:1,g=w*t.radius(s)*h(b)+w*t.widthP(s)/2,x=(y-.5)*t.heightP(s),m=P*t.radius(s)*v(b)+P*t.depthP(s)/2),o>7&&(w=o>9?-1:1,P=9===o||10===o?1:-1,g=w*t.radius(s)*h(b)+w*t.widthP(s)/2,x=P*t.radius(s)*v(b)+P*t.heightP(s)/2,m=(y-.5)*t.depthP(s))),l=(2*n+1)*u+d+r;for(var c=0;c<t.vertexPositions[l].length;c++)t.positions[t.vertexPositions[l][c]]=g,t.positions[t.vertexPositions[l][c]+1]=x,t.positions[t.vertexPositions[l][c]+2]=m}}for(u=0;u<i;u++){y=u/i;for(d=0;d<n;d++){M=d/n,C=(2*n+1)*u+d+n+1+r,E=9*(4*(u*n+d)+a),I.x=0,I.y=0,I.z=0,I.x+=t.positions[E+3],I.x+=t.positions[E+6],I.x+=t.positions[E+30],I.x+=t.positions[E+33],I.y+=t.positions[E+4],I.y+=t.positions[E+7],I.y+=t.positions[E+31],I.y+=t.positions[E+34],I.z+=t.positions[E+5],I.z+=t.positions[E+8],I.z+=t.positions[E+32],I.z+=t.positions[E+35],I.x*=.25,I.y*=.25,I.z*=.25,D.x=t.positions[E+33]-t.positions[E+6],D.y=t.positions[E+34]-t.positions[E+7],D.z=t.positions[E+35]-t.positions[E+8],R.x=t.positions[E+3]-t.positions[E+30],R.y=t.positions[E+4]-t.positions[E+31],R.z=t.positions[E+5]-t.positions[E+32],q.x=D.y*R.z-D.z*R.y,q.y=D.z*R.x-D.x*R.z,q.z=D.x*R.y-D.y*R.x,z=Math.sqrt(q.x*q.x+q.y*q.y+q.z*q.z),q.x=-t.waffleDeep(s)*q.x/z,q.y=-t.waffleDeep(s)*q.y/z,q.z=-t.waffleDeep(s)*q.z/z,I.x+=q.x,I.y+=q.y,I.z+=q.z;for(c=0;c<t.vertexPositions[C].length;c++)t.positions[t.vertexPositions[C][c]]=I.x,t.positions[t.vertexPositions[C][c]+1]=I.y,t.positions[t.vertexPositions[C][c]+2]=I.z}}}function k(e){for(var s=a;s<a+i*n*4;s++)q.x=0,q.y=0,q.z=0,E=9*s+3,A=9*s,D.x=t.positions[E]-t.positions[A],D.y=t.positions[E+1]-t.positions[A+1],D.z=t.positions[E+2]-t.positions[A+2],E=9*s+6,R.x=t.positions[E]-t.positions[A],R.y=t.positions[E+1]-t.positions[A+1],R.z=t.positions[E+2]-t.positions[A+2],q.x+=D.y*R.z-D.z*R.y,q.y+=D.z*R.x-D.x*R.z,q.z+=D.x*R.y-D.y*R.x,z=Math.sqrt(q.x*q.x+q.y*q.y+q.z*q.z),q.x=q.x/z,q.y=q.y/z,q.z=q.z/z,t.faceNormals.push(q.x,q.y,q.z);for(var o=r;o<r+(2*n+1)*i+n+1;o++){q.x=0,q.y=0,q.z=0;for(s=0;s<t.vertexFaces[o].length;s++)q.x+=t.faceNormals[t.vertexFaces[o][s]/3],q.y+=t.faceNormals[t.vertexFaces[o][s]/3+1],q.z+=t.faceNormals[t.vertexFaces[o][s]/3+2];z=Math.sqrt(q.x*q.x+q.y*q.y+q.z*q.z),q.x=q.x/z,q.y=q.y/z,q.z=q.z/z;for(s=0;s<t.vertexFaces[o].length;s++)t.normals[t.vertexPositions[o][s]]=q.x,t.normals[t.vertexPositions[o][s]+1]=q.y,t.normals[t.vertexPositions[o][s]+2]=q.z}}function H(e){if(!t.explodeDefault&&"center"===t.explodemode)for(var o=0;o<i;o++){y=o/i;for(var u=0;u<n;u++){M=u/n,C=(2*n+1)*o+u+n+1+r,E=9*(4*(o*n+u)+a),g=t.positions[t.vertexPositions[C][0]]*t.explode(s),x=t.positions[t.vertexPositions[C][0]+1]*t.explode(s),m=t.positions[t.vertexPositions[C][0]+2]*t.explode(s);for(var d=E;d<E+36;d+=3)t.positions[d]+=g,t.positions[d+1]+=x,t.positions[d+2]+=m}}}L(o),k(o),t.explodeDefault||"center"!==t.explodemode||H(o)}function x(e){var o,i,u,d,c,l,g,x,m,y={},M={},b={};function w(){d=t.radius(s)*v(g)*v(x),c=t.radius(s)*h(g),l=-t.radius(s)*v(g)*h(x),d+=n*r*t.widthP(s)/2,c+=r*t.heightP(s)/2,l+=a*r*t.depthP(s)/2}function P(){for(var e=0;e<t.vertexPositions[o].length;e++)t.positions[t.vertexPositions[o][e]]=d,t.positions[t.vertexPositions[o][e]+1]=c,t.positions[t.vertexPositions[o][e]+2]=l}function C(e){o=t.vCornersIdx[e],g=r*p,x=p*(e%4),w(),P(),o++;for(var s=1;s<=f;s++){g=r*p*(1-s/f),x=p*(e%4);for(var i=0;i<=s;i++)w(),P(),o++,x+=p/s}}function E(e){for(var s=t.fCornersIdx[e];s<t.fCornersIdx[e]+f*f;s++)b.x=0,b.y=0,b.z=0,i=9*s+3,u=9*s,y.x=t.positions[i]-t.positions[u],y.y=t.positions[i+1]-t.positions[u+1],y.z=t.positions[i+2]-t.positions[u+2],i=9*s+6,M.x=t.positions[i]-t.positions[u],M.y=t.positions[i+1]-t.positions[u+1],M.z=t.positions[i+2]-t.positions[u+2],b.x+=y.y*M.z-y.z*M.y,b.y+=y.z*M.x-y.x*M.z,b.z+=y.x*M.y-y.y*M.x,m=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z),b.x=b.x/m,b.y=b.y/m,b.z=b.z/m,t.faceNormals.push(b.x,b.y,b.z);for(var o=t.vCornersIdx[e];o<t.vCornersIdx[e]+(f+1)*(f+2)/2;o++){b.x=0,b.y=0,b.z=0;for(s=0;s<t.vertexFaces[o].length;s++)b.x+=t.faceNormals[t.vertexFaces[o][s]/3],b.y+=t.faceNormals[t.vertexFaces[o][s]/3+1],b.z+=t.faceNormals[t.vertexFaces[o][s]/3+2];m=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z),b.x=b.x/m,b.y=b.y/m,b.z=b.z/m;for(s=0;s<t.vertexFaces[o].length;s++)t.normals[t.vertexPositions[o][s]]=b.x,t.normals[t.vertexPositions[o][s]+1]=b.y,t.normals[t.vertexPositions[o][s]+2]=b.z}}function A(e){for(var o=t.fCornersIdx[e];o<t.fCornersIdx[e]+f*f;o++){i=9*o,d=0,c=0,l=0,d+=t.positions[i]+t.positions[i+3]+t.positions[i+6],c+=t.positions[i+1]+t.positions[i+4]+t.positions[i+7],l+=t.positions[i+2]+t.positions[i+5]+t.positions[i+8],d=t.explode(s)*d/3,c=t.explode(s)*c/3,l=t.explode(s)*l/3;for(var n=0;n<9;n+=3)t.positions[i+n]+=d,t.positions[i+n+1]+=c,t.positions[i+n+2]+=l}}r=e<4?1:-1,n=(e%4%3===0?1:-1)*r,a=(e%4>1?1:-1)*r,C(e),E(e),t.explodeDefault||"center"!==t.explodemode||A(e)}t.attributes.position.needsUpdate=!0,t.attributes.normal.needsUpdate=!0,t.faceNormals=[];for(var m=0;m<6;m++)-1!==t.fPlanesIdx[m]&&g("plane",m);for(m=0;m<12;m++)-1!==t.fEdgesIdx[m]&&g("edge",m);for(var y=0;y<8;y++)-1!==t.fCornersIdx[y]&&x(y);if(!t.explodeDefault&&"normal"===t.explodemode)for(var M=0;M<t.faceCount;M++){o=3*M;for(var b=0;b<3;b++)i=9*M+3*b,t.positions[i]=t.positions[i]+t.faceNormals[o]*t.radius(s)*t.explode(s),t.positions[i+1]=t.positions[i+1]+t.faceNormals[o+1]*t.radius(s)*t.explode(s),t.positions[i+2]=t.positions[i+2]+t.faceNormals[o+2]*t.radius(s)*t.explode(s)}}function n(e){void 0===e&&(e={}),t=this,t.driftXDefault=void 0===e.driftX,t.driftYDefault=void 0===e.driftY,t.driftZDefault=void 0===e.driftZ,t.driftDefault=t.driftXDefault&&t.driftYDefault&&t.driftZDefault,t.explodeDefault=void 0===e.explode,t.equator=void 0!==e.equator?e.equator:6,t.uvmode=void 0!==e.uvmode?e.uvmode:0,t.contourmode=void 0!==e.contourmode?e.contourmode:"rounding",t.explodemode=void 0!==e.explodemode?e.explodemode:"center",t.parts=void 0!==e.parts?e.parts:[1,1,1,1,1,1,1,1],t.radius=void 0!==e.radius?e.radius:function(e){return 1},t.rounding=void 0!==e.rounding?e.rounding:function(e){return 1},t.profile=void 0!==e.profile?e.profile:function(e,t){return Math.sin(e)},t.pointX=void 0!==e.pointX?e.pointX:function(e){return.001},t.pointY=void 0!==e.pointY?e.pointY:function(e){return.999},t.driftX=void 0!==e.driftX?e.driftX:function(e){return 0},t.driftY=void 0!==e.driftY?e.driftY:function(e){return 0},t.driftZ=void 0!==e.driftZ?e.driftZ:function(e){return 0},t.explode=void 0!==e.explode?e.explode:function(e){return 0},t.buildMagicSphere=r,t.morphVerticesMagicSphere=a,t.buildMagicSphere(),t.morphVerticesMagicSphere()}function r(){t=this;var e,s,o,i,n,r,a,u,d,c,f,l,p,h,v=t.equator,g=0,x=0,m=[],y=[],M=[!1,!1,!1];t.partCount=0;for(var b=0;b<8;b++)t.partCount+=1===t.parts[b]?1:0;const w=Math.PI/2;function P(e){c=9*d,m.push(c),y.push(c+e)}function C(){for(var e=0;e<t.vertexPositions[n].length;e++)r=t.vertexPositions[n][e]/3*2,t.uvs[r]=s,t.uvs[r+1]=o}function E(){m=[9*x],y=[9*x],M=[!0,!0,!1],t.vertexFaces.push(m),t.vertexPositions.push(y),t.vLoc.push(M);for(var e=1;e<=v;e++){a=(e-1)*(e-1)+x,u=e*e+x;for(var s=0;s<=e;s++)m=[],y=[],M=[!1,!1,!1],0===s&&(d=a,P(l),e<v?(d=u,P(f),d++,P(p)):M[2]=!0,M[0]=!0),s>0&&s<e&&(d=a+2*(s-1),P(p),d++,P(f),d++,P(l),e<v?(d=u+2*s-1,P(l),d++,P(f),d++,P(p)):M[2]=!0),s===e&&(d=u-1,P(p),e<v?(d=(e+1)*(e+1)-2+x,P(l),d++,P(f)):M[2]=!0,M[1]=!0),t.vertexFaces.push(m),t.vertexPositions.push(y),t.vLoc.push(M)}}function A(){var r,a=1/v;if(n=g,0===t.uvmode){s=.5,o=1,C(),n++;for(var u=1;u<=v;u++){s=.5-i*u*a/2,o-=a;for(var d=0;d<=u;d++)C(),n++,s+=i*a}}if(1===t.uvmode){s=.5,o=.5,C(),n++;for(u=1;u<=v;u++){r=u/v,h=w*(e%4);for(d=0;d<=u;d++)s=.5*(1-i*r*Math.sin(h)),o=.5*(1+r*Math.cos(h)),C(),n++,h+=w/u}}}t.vertexCount=(v+1)*(v+2)/2*t.partCount,t.faceCount=v*v*t.partCount,t.positions=new Float32Array(9*t.faceCount),t.normals=new Float32Array(9*t.faceCount),t.uvs=new Float32Array(6*t.faceCount),t.addAttribute("position",new THREE.BufferAttribute(t.positions,3).setDynamic(!0)),t.addAttribute("normal",new THREE.BufferAttribute(t.normals,3).setDynamic(!0)),t.addAttribute("uv",new THREE.BufferAttribute(t.uvs,2)),t.vertexFaces=[],t.vertexPositions=[],t.vLoc=[];for(b=0;b<8;b++)1===t.parts[b]&&(e=b,i=e<4?1:-1,(e%4%3===0?1:-1)*i,(e%4>1?1:-1)*i,f=0,l=b<4?3:6,p=b<4?6:3,E(),A(),g+=(v+1)*(v+2)/2,x+=v*v);x=0;for(var z=0;z<8;z++)if(1===t.parts[z]){for(var I=x,D=3*x;I<x+v*v;I++,D+=3)t.addGroup(D,3,z+1);x+=v*v}}function a(e){var s=void 0!==e?e:0;t=this;var o,i,n,r,a,u,d,c,f,l,p,h,v,g,x,m=t.equator,y=0,M=0,b={},w={},P={};const C=Math.PI,E=Math.PI/2;function A(e){var o=t.pointX(s),i=t.pointY(s);function n(e){var t,s=E-2*o;if(0===s)t=e/(2*o);else{var n=o/s,r=n*n+e/s;t=-n+(o<E/2?1:-1)*Math.sqrt(r)}return(1-2*i)*t*t+2*i*t}function r(e){var t=(1-i)/(E-o);return e>o?t*e+1-E*t:i/o*e}if("rounding"===t.contourmode){var a=2/C*Math.asin(Math.sin(e)),u=Math.sin(e);return a+t.rounding(s)*(u-a)}var d="profile"===t.contourmode?t.profile:"bezier"===t.contourmode?n:r;return e<0?-d(-e,s):e>=0&&e<=E?d(e,s):e>E&&e<=C?d(C-e,s):e>C&&e<=3*E?-d(e-C,s):e>3*E&&e<=2*C?-d(2*C-e,s):e>2*C&&e<=5*E+.001?d(e-2*C,s):void 0}function z(e){return A(e+E)}function I(){d=t.radius(s)*z(l)*z(p),c=t.radius(s)*A(l),f=-t.radius(s)*z(l)*A(p),t.driftDefault||(d+=h*v*t.driftX(s),c+=v*t.driftY(s),f+=g*v*t.driftZ(s))}function D(){for(var e=0;e<t.vertexPositions[i].length;e++)t.positions[t.vertexPositions[i][e]]=d,t.positions[t.vertexPositions[i][e]+1]=c,t.positions[t.vertexPositions[i][e]+2]=f}function R(){i=y,l=v*E,p=E*(o%4),I(),D(),i++;for(var e=1;e<=m;e++){l=v*E*(1-e/m),p=E*(o%4);for(var t=0;t<=e;t++)I(),D(),i++,p+=E/e}}function q(){for(var e=M;e<M+t.faceCount/t.partCount;e++)P.x=0,P.y=0,P.z=0,n=9*e+3,r=9*e,b.x=t.positions[n]-t.positions[r],b.y=t.positions[n+1]-t.positions[r+1],b.z=t.positions[n+2]-t.positions[r+2],n=9*e+6,w.x=t.positions[n]-t.positions[r],w.y=t.positions[n+1]-t.positions[r+1],w.z=t.positions[n+2]-t.positions[r+2],P.x+=b.y*w.z-b.z*w.y,P.y+=b.z*w.x-b.x*w.z,P.z+=b.x*w.y-b.y*w.x,x=Math.sqrt(P.x*P.x+P.y*P.y+P.z*P.z),P.x=P.x/x,P.y=P.y/x,P.z=P.z/x,t.faceNormals.push(P.x,P.y,P.z);for(var s=y;s<y+t.vertexFaces.length/t.partCount;s++){P.x=0,P.y=0,P.z=0;for(e=0;e<t.vertexFaces[s].length;e++)P.x+=t.faceNormals[t.vertexFaces[s][e]/3],P.y+=t.faceNormals[t.vertexFaces[s][e]/3+1],P.z+=t.faceNormals[t.vertexFaces[s][e]/3+2];t.vLoc[s][0]||t.vLoc[s][1]||t.vLoc[s][2]?(t.vLoc[s][0]&&t.vLoc[s][1]&&(P.x=0,P.y=v,P.z=0),(t.vLoc[s][0]&&!t.vLoc[s][1]&&!t.vLoc[s][2]||!t.vLoc[s][0]&&t.vLoc[s][1]&&!t.vLoc[s][2])&&(P.x*P.x<P.z*P.z?(P.x=0,x=Math.sqrt(P.y*P.y+P.z*P.z),P.y=P.y/x,P.z=P.z/x):(x=Math.sqrt(P.x*P.x+P.y*P.y),P.x=P.x/x,P.y=P.y/x,P.z=0)),(t.vLoc[s][0]&&!t.vLoc[s][1]&&t.vLoc[s][2]||!t.vLoc[s][0]&&t.vLoc[s][1]&&t.vLoc[s][2])&&(P.x*P.x<P.z*P.z?(P.x=0,P.y=0,P.z=g):(P.x=h,P.y=0,P.z=0)),t.vLoc[s][0]||t.vLoc[s][1]||!t.vLoc[s][2]||(x=Math.sqrt(P.x*P.x+P.z*P.z),P.x=P.x/x,P.y=0,P.z=P.z/x)):(x=Math.sqrt(P.x*P.x+P.y*P.y+P.z*P.z),P.x=P.x/x,P.y=P.y/x,P.z=P.z/x);for(e=0;e<t.vertexFaces[s].length;e++)t.normals[t.vertexPositions[s][e]]=P.x,t.normals[t.vertexPositions[s][e]+1]=P.y,t.normals[t.vertexPositions[s][e]+2]=P.z}}function L(){for(var e=M;e<M+m*m;e++){n=9*e,d=0,c=0,f=0,d+=t.positions[n]+t.positions[n+3]+t.positions[n+6],c+=t.positions[n+1]+t.positions[n+4]+t.positions[n+7],f+=t.positions[n+2]+t.positions[n+5]+t.positions[n+8],d=t.explode(s)*d/3,c=t.explode(s)*c/3,f=t.explode(s)*f/3;for(var o=0;o<9;o+=3)t.positions[n+o]+=d,t.positions[n+o+1]+=c,t.positions[n+o+2]+=f}}t.attributes.position.needsUpdate=!0,t.attributes.normal.needsUpdate=!0,t.faceNormals=[];for(var k=0;k<8;k++)1===t.parts[k]&&(o=k,v=o<4?1:-1,h=(o%4%3===0?1:-1)*v,g=(o%4>1?1:-1)*v,R(),q(),t.explodeDefault||"center"!==t.explodemode||L(),y+=(m+1)*(m+2)/2,M+=m*m);if(!t.explodeDefault&&"normal"===t.explodemode)for(var H=0;H<t.faceCount;H++){a=3*H;for(k=0;k<3;k++)u=9*H+3*k,t.positions[u]=t.positions[u]+t.faceNormals[a]*t.radius(s)*t.explode(s),t.positions[u+1]=t.positions[u+1]+t.faceNormals[a+1]*t.radius(s)*t.explode(s),t.positions[u+2]=t.positions[u+2]+t.faceNormals[a+2]*t.radius(s)*t.explode(s)}}function u(e,s,o){if(t=this,t.dim=e,t.storeys="3D"===e?s.length:1,"3D"===e)t.design=s;else{t.design=[],t.design.push([]);for(var i,n,r=s.length,a=0;a<t.storeys;a++)for(var u=0;u<r;u++){i=s[u].length,n="";for(var c=0;c<i;c++)n+=f(s);t.design[0].push(n)}}function f(e){var t=!1,s=!1,o=!1,n=!1;return"+"!==e[u][c]?" ":((0===c||"+"!==e[u][c-1])&&(t=!0),(0===u||"+"!==e[u-1][c])&&(s=!0),(c===i-1||"+"!==e[u][c+1])&&(o=!0),(u===r-1||"+"!==e[u+1][c])&&(n=!0),t&&s&&o&&n?"G":t&&s&&o&&!n?"M":t&&s&&!o&&n?"C":!t&&s&&o&&n?"3":t&&!s&&o&&n?"U":t&&!s&&o&&!n?"H":!t&&s&&!o&&n?":":t&&s&&!o&&!n?"F":!t&&s&&o&&!n?"7":t&&!s&&!o&&n?"L":!t&&!s&&o&&n?"J":!t||s||o||n?t||s||!o||n?t||!s||o||n?t||s||o||!n?t||s||o||n?void 0:"*":".":"-":"1":"I")}"3D"===e?t.m=o:(t.m=[],t.m.push(o)),t.buildLabyrinth=d,t.buildLabyrinth()}function d(){var e,s,o,i,n;t=this;var r=[],a=0,u=[],d=0,c=0;t.faceCount=0;for(var f=0;f<t.storeys;f++)for(var l=0;l<t.design[f].length;l++)for(var p=0;p<t.design[f][l].length;p++)s=t.design[t.storeys-1-f][l][p]," "!==s&&h(s);t.positions=new Float32Array(9*t.faceCount),t.uvs=new Float32Array(6*t.faceCount),t.addAttribute("position",new THREE.BufferAttribute(t.positions,3)),t.addAttribute("uv",new THREE.BufferAttribute(t.uvs,2));for(f=0;f<t.storeys;f++)for(l=0;l<t.design[f].length;l++)for(p=0;p<t.design[f][l].length;p++)s=t.design[t.storeys-1-f][l][p]," "!==s&&(o=p+1,i=f+1,n=l+1,v(s));function h(e){switch(e){case"G":t.faceCount+=12;break;case"M":case"C":case"3":case"U":t.faceCount+=10;break;case"H":case":":case"F":case"7":case"L":case"J":case"#":t.faceCount+=8;break;case"I":case"1":case"-":case".":t.faceCount+=6;break;case"*":t.faceCount+=4;break;case"^":case"v":t.faceCount+=2;break;default:}}function v(s){switch(r=[],u=[],e=t.storeys-1-f,s){case"G":C();break;case"M":E();break;case"C":A();break;case"3":z();break;case"U":I();break;case"H":D();break;case":":R();break;case"F":q();break;case"7":L();break;case"L":k();break;case"J":H();break;case"I":F();break;case"1":T();break;case"-":B();break;case".":S();break;case"*":G();break;case"^":Y();break;case"v":N();break;case"x":X();break;case"#":Z();break;default:X()}for(let e=0;e<r.length;e++)t.positions[a+e]=r[e];a+=r.length;for(let e=0;e<u.length;e++)t.uvs[d+e]=u[e];d+=u.length}function g(){u.push(0,0,0,1,1,1,0,0,1,1,1,0)}function x(e){t.addGroup(c,6,e),c+=6}function m(){r.push(o,f,l,o,i,l,o,i,n,o,f,l,o,i,n,o,f,n),g(),x(t.m[e][0])}function y(){r.push(p,f,n,p,i,n,p,i,l,p,f,n,p,i,l,p,f,l),g(),x(t.m[e][1])}function M(){r.push(p,i,n,o,i,n,o,i,l,p,i,n,o,i,l,p,i,l),g(),x(t.m[e][2])}function b(){r.push(p,f,l,o,f,l,o,f,n,p,f,l,o,f,n,p,f,n),g(),x(t.m[e][3])}function w(){r.push(o,f,n,o,i,n,p,i,n,o,f,n,p,i,n,p,f,n),g(),x(t.m[e][4])}function P(){r.push(p,f,l,p,i,l,o,i,l,p,f,l,o,i,l,o,f,l),g(),x(t.m[e][5])}function C(){m(),y(),M(),b(),w(),P()}function E(){m(),y(),M(),b(),P()}function A(){y(),M(),b(),w(),P()}function z(){m(),M(),b(),w(),P()}function I(){m(),y(),M(),b(),w()}function D(){m(),y(),M(),b()}function R(){M(),b(),w(),P()}function q(){y(),M(),b(),P()}function L(){m(),M(),b(),P()}function k(){y(),M(),b(),w()}function H(){m(),M(),b(),w()}function F(){y(),M(),b()}function T(){m(),M(),b()}function B(){M(),b(),P()}function S(){M(),b(),w()}function G(){M(),b()}function Y(){b()}function N(){M()}function X(){}function Z(){m(),y(),w(),P()}}function c(e,s,o,i,n){var r,a,u,d,c;t=this,t.multiMaterial=s||"side",t.plane=!1,Array.isArray(e[0])?t.dsgn=e:(t.dsgn=[[],[],[],[],e],t.plane=!0),t.sides=t.dsgn.length,t.w2=0,t.h2=0,t.d2=0,t.convDsgn=[],t.binDsgn=[],t.lines=[],t.lineCount=0;for(var l=0;l<t.sides;l++)if(t.convDsgn.push([]),a=t.dsgn[l].length,0!==a)for(var p=0;p<t.dsgn[l].length;p++){d=[],u=t.dsgn[l][p].length;for(var h=0;h<u;h++)d.push(t.dsgn[l][p][h]);t.convDsgn[l].push(d)}for(l=0;l<t.sides;l++){if(t.binDsgn.push([]),a=t.convDsgn[l].length,0!==a){for(p=0;p<t.convDsgn[l].length;p++){c=[],u=t.convDsgn[l][p].length;for(h=0;h<u;h++)"+"===t.convDsgn[l][p][h]&&(t.convDsgn[l][p][h]=g(l)),c.push(x(t.convDsgn[l][p][h]));t.binDsgn[l].push(c),void 0!==o||0!==l&&1!==l||0!==p||(t.w2=Math.max(t.w2,u)),void 0!==i||2!==l&&3!==l||0!==p||(t.h2=Math.max(t.h2,u)),void 0!==n||4!==l&&5!==l||0!==p||(t.d2=Math.max(t.d2,u))}for(let e=1;e<a;e++){u=t.binDsgn[l][e].length;for(let s=0;s<u;s++)t.binDsgn[l][e][s]=(1&t.binDsgn[l][e-1][s])<<2^t.binDsgn[l][e][s]}for(let e=0;e<a;e++){u=t.binDsgn[l][e].length;for(let s=1;s<u;s++)t.binDsgn[l][e][s]=(2&t.binDsgn[l][e][s-1])<<2^t.binDsgn[l][e][s]}for(let e=0;e<a;e++){u=t.binDsgn[l][e].length;for(let s=0;s<u;s++)r=t.binDsgn[l][e][s],t.lineCount+=((8&r)>>3)+((4&r)>>2)+((2&r)>>1)+(1&r)}}t.lines.push(t.lineCount)}function v(e,t,s,o){return e&&t&&s&&o?"G":e&&t&&s&&!o?"M":e&&t&&!s&&o?"C":!e&&t&&s&&o?"3":e&&!t&&s&&o?"U":e&&!t&&s&&!o?"H":!e&&t&&!s&&o?":":e&&t&&!s&&!o?"F":!e&&t&&s&&!o?"7":e&&!t&&!s&&o?"L":!e&&!t&&s&&o?"J":!e||t||s||o?e||t||!s||o?e||!t||s||o?e||t||s||!o?e||t||s||o?void 0:" ":".":"-":"1":"I"}function g(e){var s=!1,o=!1,i=!1,n=!1;return(0===h||"+"!==t.dsgn[e][p][h-1])&&(s=!0),(0===p||"+"!==t.dsgn[e][p-1][h])&&(o=!0),(h===u-1||"+"!==t.dsgn[e][p][h+1])&&(i=!0),(p===a-1||"+"!==t.dsgn[e][p+1][h])&&(n=!0),v(s,o,i,n)}function x(e){switch(e){case"+":return 0;case"G":case"#":return 15;case"M":return 14;case"C":return 13;case"3":return 7;case"U":return 11;case"H":return 10;case":":return 5;case"F":return 12;case"7":return 6;case"L":return 9;case"J":return 3;case"I":return 8;case"1":return 2;case"-":return 4;case".":return 1;case" ":return 0}}t.w2=void 0===o?t.w2/2:o/2,t.h2=void 0===i?t.h2/2:i/2,t.d2=void 0===n?t.d2/2:n/2,t.d2=t.plane?0:t.d2,e=[],t.dsgn=[],t.convDsgn=[],t.buildLineGrid=f,t.buildLineGrid()}function f(){var e,s,o,i,n,r,a,u,d,c,f,l,p,h,v,g,x=0,m=0;t.prevLineCount=0,t.positions=new Float32Array(6*t.lineCount),t.uvs=new Float32Array(4*t.lineCount),t.addAttribute("position",new THREE.BufferAttribute(t.positions,3)),t.addAttribute("uv",new THREE.BufferAttribute(t.uvs,2));for(var y=0;y<t.sides;y++)if(0!==t.binDsgn[y].length){e=t.binDsgn[y].length,s=t.binDsgn[y][0].length,i=0===y||2===y||5===y?-1:1;for(var M=0;M<e;M++)for(var b=0;b<t.binDsgn[y][M].length;b++)o=t.binDsgn[y][M][b],0!==o&&(d=i*(b-s/2),c=d+i,f=e/2-M,l=f-1,p=b/s,h=(b+1)/s,v=(e-M-1)/e,g=(e-M)/e,w(o));"side"===t.multiMaterial&&(t.addGroup(2*t.prevLineCount,2*(t.lines[y]-t.prevLineCount),t.plane?0:y),t.prevLineCount=t.lines[y])}function w(e){n=[],r=[],a=[],u=[],0!==(8&e)&&P(y),0!==(4&e)&&C(y),0!==(2&e)&&E(y),0!==(1&e)&&A(y);for(let s=0;s<n.length;s++)t.positions[x+s]=n[s];"align"===t.multiMaterial&&t.addGroup(x/3,n.length/3,0),x+=n.length;for(let s=0;s<r.length;s++)t.positions[x+s]=r[s];"align"===t.multiMaterial&&t.addGroup(x/3,r.length/3,1),x+=r.length;for(let s=0;s<a.length;s++)t.uvs[m+s]=a[s];m+=a.length;for(let s=0;s<u.length;s++)t.uvs[m+s]=u[s];m+=u.length}function P(e){switch(e){case 0:r.push(t.w2,f,d,t.w2,l,d),u.push(v,p,g,p);break;case 1:r.push(-t.w2,f,d,-t.w2,l,d),u.push(v,p,g,p);break;case 2:r.push(d,t.h2,f,d,t.h2,l),u.push(p,v,p,g);break;case 3:r.push(d,-t.h2,f,d,-t.h2,l),u.push(p,v,p,g);break;case 4:r.push(d,f,t.d2,d,l,t.d2),u.push(p,v,p,g);break;case 5:r.push(d,f,-t.d2,d,l,-t.d2),u.push(p,v,p,g);break}}function C(e){switch(e){case 0:n.push(t.w2,f,d,t.w2,f,c),a.push(v,p,v,h);break;case 1:n.push(-t.w2,f,d,-t.w2,f,c),a.push(v,p,v,h);break;case 2:n.push(d,t.h2,f,c,t.h2,f),a.push(p,v,h,v);break;case 3:n.push(d,-t.h2,f,c,-t.h2,f),a.push(p,v,h,v);break;case 4:n.push(d,f,t.d2,c,f,t.d2),a.push(p,v,h,v);break;case 5:n.push(d,f,-t.d2,c,f,-t.d2),a.push(p,v,h,v);break}}function E(e){switch(e){case 0:r.push(t.w2,f,c,t.w2,l,c),u.push(v,h,g,h);break;case 1:r.push(-t.w2,f,c,-t.w2,l,c),u.push(v,h,g,h);break;case 2:r.push(c,t.h2,f,c,t.h2,l),u.push(h,v,h,g);break;case 3:r.push(c,-t.h2,f,c,-t.h2,l),u.push(h,v,h,g);break;case 4:r.push(c,f,t.d2,c,l,t.d2),u.push(h,v,h,g);break;case 5:r.push(c,f,-t.d2,c,l,-t.d2),u.push(h,v,h,g);break}}function A(e){switch(e){case 0:n.push(t.w2,l,d,t.w2,l,c),a.push(g,p,g,h);break;case 1:n.push(-t.w2,l,d,-t.w2,l,c),a.push(g,p,g,h);break;case 2:n.push(d,t.h2,l,c,t.h2,l),a.push(p,g,h,g);break;case 3:n.push(d,-t.h2,l,c,-t.h2,l),a.push(p,g,h,g);break;case 4:n.push(d,l,t.d2,c,l,t.d2),a.push(p,g,h,g);break;case 5:n.push(d,l,-t.d2,c,l,-t.d2),a.push(p,g,h,g);break}}}function l(e,s,o,i,n){t=this,t.profileShape=e,t.contour=s,t.contourClosed=void 0===o||o,t.openEnded=void 0!==i&&i,t.openEnded=!0!==o&&i,t.profileMaterial=void 0!==n&&n,t.contourClosed&&t.contour.push(t.contour[0],t.contour[1]),t.buildProfiledContourMMgeometry=p,t.buildProfiledContourMMgeometry()}function p(){var e,s,o,i,n,r,a,u,d,c,f,l,p,h,v,g,x,m,y,M,b,w,P,C,E,A,z,I,D,R,q,L,k,H,F=t.contour.length/2,T=t.profileShape.length/2,B=F-1,S=T-1,G=B*S*2+(t.openEnded?0:2*S),Y=F*T+(t.openEnded?0:2);t.indices=new Uint32Array(3*G),t.positions=new Float32Array(3*Y),t.setIndex(new THREE.BufferAttribute(t.indices,1)),t.addAttribute("position",new THREE.BufferAttribute(t.positions,3));for(var N=1e-6,X=0,Z=0;Z<B;Z++){t.profileMaterial&&t.addGroup(X,6*S,Z),n=Z+1;for(var U=0;U<S;U++)e=T*Z+U,o=T*n+U,s=o+1,i=e+1,t.indices[X]=e,t.indices[X+1]=s,t.indices[X+2]=o,t.indices[X+3]=e,t.indices[X+4]=i,t.indices[X+5]=s,t.profileMaterial||t.addGroup(X,6,U),X+=6}if(!t.openEnded){t.addGroup(X,3*S,S),e=F*T;for(U=0;U<S;U++)t.indices[X]=e,t.indices[X+1]=U+1,t.indices[X+2]=U,X+=3;t.addGroup(X,3*S,S+1),e+=1;for(U=T+1;U>1;U--)t.indices[X]=e,t.indices[X+1]=e-U,t.indices[X+2]=e-U+1,X+=3}for(Z=0;Z<F;Z++){r=2*Z,d=t.contour[r],c=t.contour[r+1],0===Z?(a=t.contour[2*(B-1)],u=t.contour[2*(B-1)+1]):(a=t.contour[r-2],u=t.contour[r-1]),Z===B?(f=t.contour[2],l=t.contour[3]):(f=t.contour[r+2],l=t.contour[r+3]),t.contourClosed||(0===Z&&(x=f-d,m=l-c,C=Math.sqrt(x*x+m*m),w=x/C,P=m/C,E=P,A=-w),Z===B&&(v=d-a,g=c-u,b=Math.sqrt(v*v+g*g),y=v/b,M=g/b,E=M,A=-y),h=1,D=1),(Z>0&&Z<B||t.contourClosed)&&(v=a-d,g=u-c,x=f-d,m=l-c,Math.abs(m/x-g/v)<N&&(g+=N),Math.abs(x/m-v/g)<N&&(v+=N),b=Math.sqrt(v*v+g*g),y=v/b,M=g/b,C=Math.sqrt(x*x+m*m),w=x/C,P=m/C,E=y+w,A=M+P,z=Math.sqrt(E*E+A*A),E/=z,A/=z,I=Math.acos(w*y+P*M)/2,D=Math.sign(v*m-g*x),h=Math.sin(I));for(U=0;U<T;U++)p=t.profileShape[2*U],R=d+p/h*D*E,q=c+p/h*D*A,L=t.profileShape[2*U+1],k=T*Z+U,H=3*k,t.positions[H]=R,t.positions[H+1]=q,t.positions[H+2]=L}t.openEnded||(t.positions[F*T*3]=t.contour[0],t.positions[F*T*3+1]=t.contour[1],t.positions[F*T*3+2]=0,t.positions[F*T*3+3]=t.contour[2*B],t.positions[F*T*3+4]=t.contour[2*B+1],t.positions[F*T*3+5]=0),t.computeVertexNormals()}function h(e,s,o){t=this,t.sd=void 0!==o?[[],o,[],[]]:[[],[-.5,.5],[],[]],t.wss=[0,t.sd[1].length,0,0],t.ws=[0,t.sd[1].length-1,0,0],t.sides=[!1,!0,!1,!1],t.ls=void 0!==s?s:500,t.lss=t.ls+1,t.cP=void 0!==e?e:[-10,0,5,0,1,0,10,0,5];for(var i=[],n=0;n<t.cP.length;n+=3)i.push(new THREE.Vector3(t.cP[n],t.cP[n+1],t.cP[n+2]));t.curve=new THREE.CatmullRomCurve3(i),t.len=t.curve.getLength(),t.points=t.curve.getPoints(t.ls),t.len=t.curve.getLength(),t.lenList=t.curve.getLengths(t.ls),t.isWall=!1,t.buildRoadWall=g,t.buildRoadWall()}function v(e,s,o,i,n){t=this,t.sd=void 0!==o?o:[[-1,1],[-.5,.5],[-1,1],[-.5,.5]],t.wd=void 0!==i?i:void 0!==o&&o[1].length>1?t.sd[1][t.sd[1].length-1]-t.sd[1][0]:1,t.hd=void 0!==n?n:void 0!==o&&o[0].length>1?t.sd[0][t.sd[0].length-1]-t.sd[0][0]:2,t.sides=[!1,!1,!1,!1],t.wss=[],t.ws=[];for(var r=0;r<4;r++)t.wss[r]=t.sd[r].length,0!==t.wss[r]?(t.sides[r]=!0,t.ws[r]=t.wss[r]-1):t.ws[r]=0;t.ls=void 0!==s?s:100,t.lss=t.ls+1,t.cP=void 0!==e?e:[-10,0,5,0,1,0,10,0,5];for(var a=[],u=0;u<t.cP.length;u+=3)a.push(new THREE.Vector3(t.cP[u],t.cP[u+1],t.cP[u+2]));t.curve=new THREE.CatmullRomCurve3(a),t.len=t.curve.getLength(),t.points=t.curve.getPoints(t.ls),t.len=t.curve.getLength(),t.lenList=t.curve.getLengths(t.ls),t.isWall=!0,t.buildRoadWall=g,t.buildRoadWall()}function g(){var e,s,o,i;t.faceCount=t.ls*(t.ws[0]+t.ws[1]+t.ws[2]+t.ws[3])*2,t.vertexCount=t.lss*(t.wss[0]+t.wss[1]+t.wss[2]+t.wss[3]),t.faceIndices=new Uint32Array(3*t.faceCount),t.vertices=new Float32Array(3*t.vertexCount),t.uvs=new Float32Array(2*t.vertexCount),t.setIndex(new THREE.BufferAttribute(t.faceIndices,1)),t.addAttribute("position",new THREE.BufferAttribute(t.vertices,3)),t.addAttribute("uv",new THREE.BufferAttribute(t.uvs,2));for(var n=0,r=0,a=0,u=0;u<4;u++)if(t.sides[u]){for(var d=0;d<t.ls;d++)for(var c=0;c<t.ws[u];c++)e=r+t.wss[u]*d+c,s=r+t.wss[u]*(d+1)+c,o=r+t.wss[u]*(d+1)+1+c,i=r+t.wss[u]*d+1+c,t.faceIndices[n]=e,t.faceIndices[n+1]=s,t.faceIndices[n+2]=o,t.faceIndices[n+3]=e,t.faceIndices[n+4]=o,t.faceIndices[n+5]=i,t.addGroup(n,6,a+c),n+=6;r+=t.lss*t.wss[u],a+=t.ws[u]}var f,l=0;for(u=0;u<4;u++)if(t.sides[u])for(d=0;d<t.lss;d++)for(c=0;c<t.wss[u];c++)t.uvs[l]=t.lenList[d]/t.len,t.uvs[l+1]=c/t.ws[u],l+=2;var p,h,v,g,x,m=new THREE.Vector3(0,0,0),y=new THREE.Vector3(0,1,0);t.t=[],t.n=[],t.b=[];var M,b=0;for(d=0;d<t.lss;d++)f=t.curve.getTangent(d/t.ls),t.t.push(f.clone()),m.crossVectors(f,y),m.y=0,m.normalize(),t.n.push(m.clone()),y.crossVectors(m,f),t.b.push(y.clone());for(u=0;u<4;u++)if(t.sides[u]){if(1===u||3===u){g=t.isWall?(1===u?1:-1)*t.hd/2:0;for(d=0;d<t.lss;d++)for(c=0;c<t.wss[u];c++)p=t.points[d].x+t.sd[u][c]*t.n[d].x,h=t.points[d].y+g,v=t.points[d].z+t.sd[u][c]*t.n[d].z,w(),b++}if(0===u||2===u){x=(0===u?-1:1)*t.wd/2;for(d=0;d<t.lss;d++)for(c=0;c<t.wss[u];c++)p=t.points[d].x+x*t.n[d].x,h=t.points[d].y+t.sd[u][c],v=t.points[d].z+x*t.n[d].z,w(),b++}}function w(){M=3*b,t.vertices[M]=p,t.vertices[M+1]=h,t.vertices[M+2]=v}}function x(e){void 0===e&&(e={}),t=this,t.radius=void 0!==e.radius?e.radius:1,t.equator=void 0!==e.equator?e.equator:16,t.cut=void 0!==e.cut?e.cut:[4,4,4,4,4,4],t.parts=void 0!==e.parts?e.parts:[1,1,1,1,1,1,1,1],t.symmetric=void 0!==e.symmetric&&e.symmetric,t.symmetric?(t.buildCutSymm=m,t.buildCutSymm()):(t.buildCut=y,t.buildCut())}function m(){t=this,t.equator=t.equator>8?t.equator+(4-t.equator%4):8;const e=t.equator/4,s=2*e,o=e=>e*(e+1)/2,i=e=>e*e,n=e=>Math.sqrt(e*(2-e)),r=Math.PI/2;let a,u,d,c,f,l,p,h,v,g,x,m,y,M,b,w=0,P=0,C=0,E=0,A=0,z=[0];const I=[0,1,1,0],D=[2,3],R=[5,5,4,4];t.cutRadius=[],t.cutDistance=[],t.cutSegments=[];for(let G=0;G<6;G++)t.cutSegments[G]=4*t.cut[G];for(let G=0;G<8;G++)1===t.parts[G]&&(q(G),E+=3*i(s)+4*i(e)-i(y)-i(M)-i(b),A+=3*o(s+1)+4*o(e+1)-o(y)-o(M)-o(b)),z.push(A);t.faceIndices=new Uint32Array(3*E),t.vertices=new Float32Array(3*A),t.uvs=new Float32Array(2*A),t.setIndex(new THREE.BufferAttribute(t.faceIndices,1)),t.addAttribute("position",new THREE.BufferAttribute(t.vertices,3)),t.addAttribute("uv",new THREE.BufferAttribute(t.uvs,2));for(let G=0;G<8;G++)1===t.parts[G]&&(q(G),L(G),k(G));function q(e){y=t.cut[I[e%4]],M=t.cut[D[Math.floor(e/4)]],b=t.cut[R[e%4]]}function L(n){t.addGroup(P,3*(3*i(s)+4*i(e)-i(y)-i(M)-i(b)),n),h=z[n],m=0===n||2===n||5===n||7===n,H(y,s),h+=o(s+1)-o(y),H(M,s),h+=o(s+1)-o(M),H(b,s),h+=o(s+1)-o(b);for(let t=0;t<4;t++)H(0,e),h+=o(e+1)}function k(e){v=0===e||3===e||4===e||7===e?1:-1,g=e<4?1:-1,x=2===e||3===e||6===e||7===e?1:-1,m=0===e||2===e||5===e||7===e,t.edgeX=[],t.edgeY=[],t.edgeZ=[],t.cEdgeX=[],t.cEdgeY=[],t.cEdgeZ=[],F(e,"x",y),F(e,"y",M),F(e,"z",b),T("x",t.edgeY,t.edgeZ),T("y",t.edgeZ,t.edgeX),T("z",t.edgeX,t.edgeY),B()}function H(e,s){c=h;for(let o=e;o<s;o++){f=c+1,l=c+o+1,p=l+1;for(let e=0;e<o;e++)t.faceIndices[P]=e+c,t.faceIndices[P+1]=e+(m?p:l),t.faceIndices[P+2]=e+(m?l:p),P+=3,t.faceIndices[P]=e+c,t.faceIndices[P+1]=e+(m?f:p),t.faceIndices[P+2]=e+(m?p:f),P+=3;t.faceIndices[P]=o+c,t.faceIndices[P+1]=o+(m?p:l),t.faceIndices[P+2]=o+(m?l:p),P+=3,c+=o+1}}function F(e,o,i){let d,c,f,l,p,h;for(let m=i;m<=s;m++){a=Math.PI/2*(1-m/t.equator),u=0;for(let y=0;y<=m;y++)l=Math.sin(a),p=Math.cos(a)*Math.sin(u),h=Math.cos(a)*Math.cos(u),"x"===o&&(d=l,c=h,f=p,t.vertices[w+0]=v*t.radius*d,t.vertices[w+1]=g*t.radius*c,t.vertices[w+2]=x*t.radius*f,m===i&&0===y&&(t.cutRadius[I[e%4]]=n(1-d)*t.radius,t.cutDistance[I[e%4]]=d*t.radius),m===s&&t.edgeX.push(d,c,f)),"y"===o&&(d=p,c=l,f=h,t.vertices[w+0]=v*t.radius*d,t.vertices[w+1]=g*t.radius*c,t.vertices[w+2]=x*t.radius*f,m===i&&0===y&&(t.cutRadius[D[Math.floor(e/4)]]=n(1-c)*t.radius,t.cutDistance[D[Math.floor(e/4)]]=c*t.radius),m===s&&t.edgeY.push(d,c,f)),"z"===o&&(d=h,c=p,f=l,t.vertices[w+0]=v*t.radius*d,t.vertices[w+1]=g*t.radius*c,t.vertices[w+2]=x*t.radius*f,m===i&&0===y&&(t.cutRadius[R[e%4]]=n(1-f)*t.radius,t.cutDistance[R[e%4]]=f*t.radius),m===s&&t.edgeZ.push(d,c,f)),S(d,c,f),w+=3,u+=r/m}}function T(o,i,a){let c,f,l,p,h,m,y,M,b,P,C,E;c=i[0],f=i[1],l=i[2],t.vertices[w]=v*t.radius*c,t.vertices[w+1]=g*t.radius*f,t.vertices[w+2]=x*t.radius*l,S(c,f,l),c=a[3*s-3],f=a[3*s-2],l=a[3*s-1],t.vertices[w+3]=v*t.radius*c,t.vertices[w+4]=g*t.radius*f,t.vertices[w+5]=x*t.radius*l,S(c,f,l),c=i[3],f=i[4],l=i[5],t.vertices[w+6]=v*t.radius*c,t.vertices[w+7]=g*t.radius*f,t.vertices[w+8]=x*t.radius*l,S(c,f,l),w+=9;for(let A=2;A<=e;A++){P=3*A,y=a[3*s-P],M=a[3*s+1-P],b=a[3*s+2-P],p=i[P],h=i[1+P],m=i[2+P],C=1-("x"===o?p:"y"===o?h:m),E=n(C),u="x"===o?Math.acos(b/E):"y"===o?Math.acos(y/E):Math.acos(M/E),d=(r-2*u)/A;for(let s=0;s<=A;s++)"x"===o&&(c=p,f=E*Math.sin(u),l=E*Math.cos(u),A===e&&t.cEdgeX.push(c,f,l)),"y"===o&&(c=E*Math.cos(u),f=h,l=E*Math.sin(u),A===e&&t.cEdgeY.push(c,f,l)),"z"===o&&(c=E*Math.sin(u),f=E*Math.cos(u),l=m,A===e&&t.cEdgeZ.push(c,f,l)),t.vertices[w]=v*t.radius*c,t.vertices[w+1]=g*t.radius*f,t.vertices[w+2]=x*t.radius*l,S(c,f,l),u+=d,w+=3}}function B(){let s,o,i,a,c;s=t.cEdgeY[0],o=t.cEdgeY[1],i=t.cEdgeY[2],t.vertices[w]=v*t.radius*s,t.vertices[w+1]=g*t.radius*o,t.vertices[w+2]=x*t.radius*i,S(s,o,i),s=t.cEdgeZ[3*e-3],o=t.cEdgeZ[3*e-2],i=t.cEdgeZ[3*e-1],t.vertices[w+3]=v*t.radius*s,t.vertices[w+4]=g*t.radius*o,t.vertices[w+5]=x*t.radius*i,S(s,o,i),s=t.cEdgeY[3],o=t.cEdgeY[4],i=t.cEdgeY[5],t.vertices[w+6]=v*t.radius*s,t.vertices[w+7]=g*t.radius*o,t.vertices[w+8]=x*t.radius*i,S(s,o,i),w+=9;for(let f=2;f<=e;f++){a=1-t.cEdgeZ[3*e-3*f],c=n(a),u=Math.acos(t.cEdgeZ[3*e-3*f+2]/c),d=(r-2*u)/f;for(let n=0;n<=f;n++)s=t.cEdgeZ[3*e-3*f],o=c*Math.sin(u),i=c*Math.cos(u),t.vertices[w]=v*t.radius*s,t.vertices[w+1]=g*t.radius*o,t.vertices[w+2]=x*t.radius*i,S(s,o,i),w+=3,u+=d}}function S(e,s,o){let i;e+=.4*e*(1-Math.cos(r*s)),o+=.4*o*(1-Math.cos(r*s)),i=(Math.asin(e)+Math.acos(o))/2/r,t.uvs[C]=m?1-i:i,t.uvs[C+1]=Math.asin(s)/r,C+=2}}function y(){t=this;const e=e=>e*(e+1)/2,s=e=>e*e,o=e=>.84*e*e+.16*e,i=e=>Math.sqrt(e*(2-e)),n=Math.PI,r=n/2;let a,u,d,c,f,l,p,h,v,g,x,m,y=0,M=0,b=0,w=0,P=0,C=[0];const E=[2,3],A=[5,5,4,4],z=[0,1,1,0];t.cutRadius=[],t.cutDistance=[],t.cutSegments=[];for(let q=0;q<6;q++)t.cutSegments[q]=4*t.cut[q];for(let q=0;q<8;q++)1===t.parts[q]&&(I(q),w+=s(t.equator)-s(a)-s(u)-s(d),P+=e(t.equator+1)-e(a)-e(u)-e(d)),C.push(P);t.faceIndices=new Uint32Array(3*w),t.vertices=new Float32Array(3*P),t.uvs=new Float32Array(2*P),t.setIndex(new THREE.BufferAttribute(t.faceIndices,1)),t.addAttribute("position",new THREE.BufferAttribute(t.vertices,3)),t.addAttribute("uv",new THREE.BufferAttribute(t.uvs,2));for(let q=0;q<8;q++)1===t.parts[q]&&(I(q),f=t.equator-u,l=t.equator-d,D(q),R(q));function I(e){a=t.cut[E[Math.floor(e/4)]],u=t.cut[A[e%4]],d=t.cut[z[e%4]]}function D(e){t.addGroup(M,3*(s(t.equator)-s(a)-s(u)-s(d)),e),p=C[e];for(let s=a;s<t.equator;s++){x=s-(s>f?s-f:0)-(s>l?s-l:0),h=p+1,v=p+x+(s<f?1:0),g=v+1,m=0===e||2===e||5===e||7===e;for(let e=0;e<x;e++)(s<f||e>0)&&(t.faceIndices[M]=e+p,t.faceIndices[M+1]=e+(m?g:v),t.faceIndices[M+2]=e+(m?v:g),M+=3),t.faceIndices[M]=e+p,t.faceIndices[M+1]=e+(m?h:g),t.faceIndices[M+2]=e+(m?g:h),M+=3;s<l&&(t.faceIndices[M]=x+p,t.faceIndices[M+1]=x+(m?g:v),t.faceIndices[M+2]=x+(m?v:g),M+=3),p+=x+1}}function R(e){const s=0===e||3===e||4===e||7===e?1:-1,n=e<4?1:-1,p=2===e||3===e||6===e||7===e?1:-1;let h,v,g,x,m,M,w,P,C,I,D,R,q,L,k,H=0===e||2===e||5===e||7===e,F=[],T=[],B=Math.sin(r*(1-a/t.equator)),S=1-B,G=i(S),Y=1-Math.sin(r*(1-u/t.equator)),N=1-Math.sin(r*(1-d/t.equator)),X=i(Y),Z=i(N);t.cutRadius[E[Math.floor(e/4)]]=G*t.radius,t.cutRadius[A[e%4]]=X*t.radius,t.cutRadius[z[e%4]]=Z*t.radius,t.cutDistance[E[Math.floor(e/4)]]=(1-S)*t.radius,t.cutDistance[A[e%4]]=(1-Y)*t.radius,t.cutDistance[z[e%4]]=(1-N)*t.radius;for(let t=a,i=0;t<=f;t++,i++)F[t]=B-(B-X)*o(i/(f-a));for(let o=f+1;o<=t.equator;o++)F[o]=X*Math.cos(r*(o-f)/u);for(let t=a,i=0;t<=l;t++,i++)T[t]=B-(B-Z)*o(i/(l-a));for(let o=l+1;o<=t.equator;o++)T[o]=Z*Math.cos(r*(o-l)/d);for(let o=a;o<=t.equator;o++){if(0===o&&0===a&&(t.vertices[y]=0,t.vertices[y+1]=n*t.radius,t.vertices[y+2]=0,y+=3,t.uvs[b]=.5,t.uvs[b+1]=1,b+=2),q=o+1-(o>f?o-f:0)-(o>l?o-l:0),o===a&&0!==a){c=0;for(let e=0;e<=q-1;e++)h=G*Math.sin(r*e/(q-1)),v=B,g=G*Math.cos(r*e/(q-1)),t.vertices[y]=s*t.radius*h,t.vertices[y+1]=n*t.radius*v,t.vertices[y+2]=p*t.radius*g,y+=3,c+=r/q,h+=.4*h*(1-Math.cos(r*v)),g+=.4*g*(1-Math.cos(r*v)),k=(Math.asin(h)+Math.acos(g))/2/r,t.uvs[b]=H?1-k:k,t.uvs[b+1]=Math.asin(v)/r,b+=2}if(o>a){o<=f?(x=0,M=F[o],P=Math.sqrt(1-F[o]*F[o])):(x=X*Math.sin(r*(o-f)/u),M=X*Math.cos(r*(o-f)/u),P=1-Y),o<=l?(m=Math.sqrt(1-T[o]*T[o]),w=T[o],C=0):(m=1-N,w=Z*Math.cos(r*(o-l)/d),C=Z*Math.sin(r*(o-l)/d)),I=m-x,D=w-M,R=C-P;for(let e=0;e<=q-1;e++)h=x+e/(q-1)*I,v=M+e/(q-1)*D,g=P+e/(q-1)*R,L=Math.sqrt((1-v*v)/(h*h+g*g)),h*=L,g*=L,t.vertices[y]=s*t.radius*h,t.vertices[y+1]=n*t.radius*v,t.vertices[y+2]=p*t.radius*g,y+=3,h+=.4*h*(1-Math.cos(r*v)),g+=.4*g*(1-Math.cos(r*v)),k=(Math.asin(h)+Math.acos(g))/2/r,t.uvs[b]=H?1-k:k,t.uvs[b+1]=Math.asin(v)/r,b+=2}}}}function M(e,t,s,o){var i,n,r,a,u,d=[],c=[],f=new THREE.LineBasicMaterial({color:o}),l=[],p=[],h=[],v=[];function g(){b++,10===b&&(b=0,M++),10===M&&(M=0,y++),10===y&&(y=0),y>0&&(r=p[y].clone(),w.add(r),r.position.x=-.8*s),(y>0||0===y&&M>0)&&(a=p[M].clone(),w.add(a)),u=p[b].clone(),w.add(u),u.position.x=.8*s}if(h[0]=[0,0,0,9,6,9,6,0,0,0],h[1]=[0,6,3,9,3,0],h[2]=[0,9,6,9,6,6,0,0,6,0],h[3]=[0,9,6,9,6,5,3,5,6,5,6,0,0,0],h[4]=[0,9,0,5,6,5,3,5,3,6,3,0],h[5]=[6,9,0,9,0,5,6,5,6,0,0,0],h[6]=[6,9,0,9,0,0,6,0,6,5,0,5],h[7]=[0,9,6,9,6,6,0,0],h[8]=[0,0,0,9,6,9,6,5,0,5,6,5,6,0,0,0],h[9]=[6,5,0,5,0,9,6,9,6,0,0,0],e.geometry.isBufferGeometry&&!e.geometry.indexed){1!==t&&3!==t||(i=e.geometry.vertexPositions.length),2!==t&&3!==t||(n=e.geometry.positions.length/9);for(var x=0;x<10;x++){l[x]=new THREE.BufferGeometry,v[x]=new Float32Array(h[x].length/2*3),l[x].addAttribute("position",new THREE.BufferAttribute(v[x],3));for(var m=0;m<h[x].length/2;m++)v[x][3*m]=.1*s*h[x][2*m],v[x][3*m+1]=.1*s*h[x][2*m+1],v[x][3*m+2]=0;p[x]=new THREE.Line(l[x],f)}if(1===t||3===t){var y=0,M=0,b=-1;for(x=0;x<i;x++){var w=new THREE.Mesh(new THREE.BufferGeometry);g(),d.push(w),e.add(d[x])}}if(2===t||3===t)for(y=0,M=0,b=-1,x=0;x<n;x++){w=new THREE.Mesh(new THREE.BufferGeometry);g(),c.push(w),e.add(c[x])}}this.update=function(t){var s,o,i;if(e.geometry.isBufferGeometry&&!e.geometry.indexed){if(1===t||3===t)for(var n=0;n<d.length;n++)d[n].position.set(e.geometry.positions[e.geometry.vertexPositions[n][0]],e.geometry.positions[e.geometry.vertexPositions[n][0]+1],e.geometry.positions[e.geometry.vertexPositions[n][0]+2]),d[n].quaternion.copy(camera.quaternion);if(2===t||3===t)for(n=0;n<c.length;n++)s=0,s+=e.geometry.positions[9*n],s+=e.geometry.positions[9*n+3],s+=e.geometry.positions[9*n+6],s/=3,o=0,o+=e.geometry.positions[9*n+1],o+=e.geometry.positions[9*n+4],o+=e.geometry.positions[9*n+7],o/=3,i=0,i+=e.geometry.positions[9*n+2],i+=e.geometry.positions[9*n+5],i+=e.geometry.positions[9*n+8],i/=3,c[n].position.set(s,o,i),c[n].quaternion.copy(camera.quaternion)}}}e.createMagicBox=s,e.buildMagicBox=o,e.morphVerticesMagicBox=i,e.createMagicSphere=n,e.buildMagicSphere=r,e.morphVerticesMagicSphere=a,e.createLabyrinth=u,e.buildLabyrinth=d,e.createLineGrid=c,e.buildLineGrid=f,e.createProfiledContourMMgeometry=l,e.buildProfiledContourMMgeometry=p,e.createRoad=h,e.createWall=v,e.buildRoadWall=g,e.createSphereCut=x,e.buildCutSymm=m,e.buildCut=y,e.vertexFaceNumbersHelper=M,Object.defineProperty(e,"__esModule",{value:!0})}));